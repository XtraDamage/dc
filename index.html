<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Doolcoin Wallet 2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        input { -webkit-user-select: text !important; user-select: text !important; }
        body { background-color: #000; color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; }
        
        .dool-card { background: #0a0a0a; border: 1px solid rgba(255,255,255,0.05); }
        .gradient-text { background: linear-gradient(135deg, #FF4D00, #FF005C); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gradient-bg { background: linear-gradient(135deg, #FF4D00, #FF005C); }
        .text-beta { color: #00C6FF; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        
        #toast { transform: translateY(-150%); transition: all 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        #toast.active { transform: translateY(0); opacity: 1; }

        .balance-text { font-size: clamp(1.5rem, 12vw, 3.5rem); line-height: 1; transition: font-size 0.2s ease; }
        
        /* –°—Ç–∏–ª–∏ —Å–∫–∞–Ω–µ—Ä–∞ */
        #reader { width: 100% !important; height: 100% !important; border: none !important; }
        #reader video { object-fit: cover !important; }
    </style>
</head>
<body class="bg-black">

    <div id="app" class="max-w-[480px] mx-auto h-[100dvh] flex flex-col relative bg-black shadow-2xl overflow-hidden">
        
        <!-- Toast -->
        <div id="toast" class="fixed top-4 left-4 right-4 z-[200] bg-[#111] p-3 rounded-2xl flex items-center gap-3 border border-white/10 opacity-0 pointer-events-none shadow-2xl">
            <div id="toast-icon" class="w-10 h-10 rounded-full flex items-center justify-center bg-orange-500/10 text-orange-500"></div>
            <div class="flex-1 min-w-0">
                <p id="toast-title" class="text-[10px] font-black uppercase text-neutral-500 tracking-wider">–°–∏—Å—Ç–µ–º–∞</p>
                <p id="toast-msg" class="text-xs font-bold text-white truncate"></p>
            </div>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
        <div id="view-loading" class="absolute inset-0 z-[100] bg-black flex flex-col items-center justify-center">
            <div class="text-6xl font-black gradient-text animate-pulse">ƒê</div>
        </div>

        <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
        <div id="view-auth" class="hidden flex-col h-full p-8 justify-center relative">
            <button id="auth-ref-btn" onclick="openModal('ref-info')" class="hidden absolute top-10 right-8 w-14 h-14 bg-white/5 border border-white/10 rounded-full flex items-center justify-center animate-bounce">
                <span class="text-2xl">üéÅ</span>
            </button>

            <div class="text-center mb-12">
                <span class="text-8xl font-black gradient-text">ƒê</span>
                <h1 class="text-4xl font-extrabold mt-4">Doolcoin</h1>
                <p class="text-neutral-500 text-sm mt-1">Wallet & Investments</p>
            </div>
            
            <div class="space-y-4">
                <button id="btn-google" class="w-full h-16 bg-white text-black rounded-2xl font-bold flex items-center justify-center gap-3 active:scale-95 transition-transform">
                    <svg width="20" height="20" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.84.81-.81z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                    –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
                </button>
                <div class="bg-white/5 rounded-2xl border border-white/10 overflow-hidden">
                    <input type="email" id="auth-email" placeholder="Email" class="w-full bg-transparent p-5 outline-none font-bold">
                    <div class="h-[1px] bg-white/10 mx-5"></div>
                    <input type="password" id="auth-password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full bg-transparent p-5 outline-none font-bold">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button id="btn-login" class="h-14 bg-white/10 rounded-2xl font-black uppercase text-xs tracking-widest">–í–æ–π—Ç–∏</button>
                    <button id="btn-register" class="h-14 border border-white/10 rounded-2xl font-black uppercase text-xs tracking-widest text-neutral-400">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
        <div id="view-main" class="hidden flex-col h-full">
            <header class="px-6 pt-12 pb-4 flex justify-between items-center">
                <div class="flex items-center gap-3" onclick="openModal('profile')">
                    <img id="main-avatar" class="w-10 h-10 rounded-full bg-neutral-800 border border-white/10 object-cover">
                    <div>
                        <p id="main-username" class="text-xs font-bold truncate max-w-[120px]">...</p>
                        <p class="text-[9px] font-black text-neutral-500 uppercase tracking-widest">–ü—Ä–æ—Ñ–∏–ª—å</p>
                    </div>
                </div>
                <button id="btn-logout" class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-neutral-500">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/></svg>
                </button>
            </header>

            <main class="flex-1 overflow-y-auto px-5 pb-32">
                <!-- –ö–æ—à–µ–ª–µ–∫ -->
                <div id="tab-wallet" class="tab-content active space-y-6">
                    <div class="dool-card rounded-[2.5rem] p-8 text-center relative overflow-hidden">
                        <div class="absolute inset-0 gradient-bg opacity-[0.02]"></div>
                        <p class="text-[10px] font-bold text-neutral-500 uppercase tracking-widest mb-2">–í–∞—à –±–∞–ª–∞–Ω—Å</p>
                        <div class="flex items-baseline justify-center gap-2 mb-8">
                            <span id="balance-val" class="balance-text font-black tracking-tighter">0.00</span>
                            <span class="text-2xl font-black gradient-text">ƒê</span>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="openModal('send')" class="flex-1 h-14 bg-white text-black rounded-2xl font-black text-xs uppercase tracking-widest">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                            <button onclick="openModal('receive')" class="flex-1 h-14 bg-white/10 rounded-2xl font-black text-xs uppercase tracking-widest">–ü–æ–ª—É—á–∏—Ç—å</button>
                            <button onclick="openModal('scan')" class="w-14 h-14 bg-white/10 rounded-2xl flex items-center justify-center">
                                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7V5a2 2 0 0 1 2-2h2M17 3h2a2 2 0 0 1 2 2v2M21 17v2a2 2 0 0 1-2 2h-2M7 21H5a2 2 0 0 1-2-2v-2"/></svg>
                            </button>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-[10px] font-black text-neutral-500 uppercase tracking-widest px-2">–ò—Å—Ç–æ—Ä–∏—è</h3>
                        <div id="tx-history" class="space-y-2"></div>
                    </div>
                </div>

                <!-- –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ -->
                <div id="tab-invest" class="tab-content space-y-6">
                    <div class="dool-card rounded-[2.5rem] p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-black">Beta Token (Œ≤)</h3>
                                <p class="text-[10px] text-blue-400 font-bold uppercase tracking-wider">–ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–∞</p>
                            </div>
                            <div class="text-right">
                                <p id="beta-price" class="text-xl font-black">0.00 ƒê</p>
                                <p class="text-[9px] text-neutral-500 font-bold uppercase">–¶–µ–Ω–∞</p>
                            </div>
                        </div>
                        <div class="h-32 mb-6">
                            <canvas id="betaChart"></canvas>
                        </div>
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            <div class="bg-white/5 p-4 rounded-2xl border border-white/5">
                                <p class="text-[9px] text-neutral-500 uppercase font-bold mb-1">–£ –≤–∞—Å</p>
                                <p class="text-lg font-black text-beta"><span id="user-beta">0.000</span> Œ≤</p>
                            </div>
                            <div class="bg-white/5 p-4 rounded-2xl border border-white/5">
                                <p class="text-[9px] text-neutral-500 uppercase font-bold mb-1">–ö–∞–ø–∏—Ç–∞–ª</p>
                                <p id="beta-cap" class="text-lg font-black truncate">0 ƒê</p>
                            </div>
                        </div>
                        <button onclick="openModal('trade')" class="w-full h-14 bg-blue-600 rounded-2xl font-black text-xs uppercase tracking-widest">–¢–æ—Ä–≥–æ–≤–∞—Ç—å Œ≤</button>
                    </div>

                    <!-- –°—Ç–µ–π–∫–∏–Ω–≥ -->
                    <div class="dool-card rounded-[2.5rem] p-6 flex items-center gap-4">
                        <div class="w-16 h-16 bg-orange-500/10 rounded-2xl flex items-center justify-center text-4xl">ü´ô</div>
                        <div class="flex-1">
                            <h3 class="text-lg font-black">–°—Ç–µ–π–∫–∏–Ω–≥</h3>
                            <p class="text-[10px] text-neutral-500 font-bold uppercase mb-2">+5% –≤ –Ω–µ–¥–µ–ª—é</p>
                            <div class="flex items-center justify-between">
                                <p class="font-bold text-sm"><span id="staked-val">0.00</span> ƒê</p>
                                <button onclick="openModal('staking')" class="text-[10px] font-black uppercase text-orange-500">–û—Ç–∫—Ä—ã—Ç—å</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –†–µ—Ñ–µ—Ä–∞–ª—ã -->
                <div id="tab-referrals" class="tab-content space-y-6">
                    <div class="dool-card rounded-[2.5rem] p-8 relative overflow-hidden">
                        <h3 class="text-2xl font-black mb-2">–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π</h3>
                        <p class="text-neutral-500 text-xs mb-6">–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π <span class="text-white font-bold">10.00 ƒê</span> –∑–∞ –∫–∞–∂–¥–æ–≥–æ.</p>
                        <div class="bg-black/50 p-4 rounded-2xl border border-white/10 flex items-center justify-between gap-4">
                            <input id="ref-link" readonly class="bg-transparent text-[10px] font-mono text-neutral-400 outline-none truncate flex-1" value="...">
                            <button onclick="copyRef()" class="w-10 h-10 bg-white text-black rounded-xl flex items-center justify-center shrink-0">
                                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="dool-card p-6 rounded-3xl text-center">
                            <p id="ref-count" class="text-2xl font-black">0</p>
                            <p class="text-[9px] font-bold text-neutral-500 uppercase">–†–µ—Ñ–µ—Ä–∞–ª–æ–≤</p>
                        </div>
                        <div class="dool-card p-6 rounded-3xl text-center">
                            <p id="ref-earned" class="text-2xl font-black">0.00</p>
                            <p class="text-[9px] font-bold text-neutral-500 uppercase">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</p>
                        </div>
                    </div>
                </div>
            </main>

            <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-[400px] h-18 bg-[#0a0a0ab0] backdrop-blur-xl border border-white/10 rounded-[2rem] flex items-center justify-around px-2 z-50">
                <button onclick="switchTab('wallet')" id="nav-wallet" class="flex-1 flex flex-col items-center justify-center h-full text-orange-500">
                    <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>
                </button>
                <button onclick="switchTab('invest')" id="nav-invest" class="flex-1 flex flex-col items-center justify-center h-full text-neutral-600">
                    <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                </button>
                <button onclick="switchTab('referrals')" id="nav-referrals" class="flex-1 flex flex-col items-center justify-center h-full text-neutral-600">
                    <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
                </button>
            </nav>
        </div>

        <!-- –ú–æ–¥–∞–ª–∫–∞: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ—Ñ–µ—Ä–∞–ª–µ -->
        <div id="modal-ref-info" class="hidden absolute inset-0 z-[150] bg-black/90 backdrop-blur-md flex items-center justify-center p-8 opacity-0 transition-all">
            <div class="w-full max-w-xs bg-[#111] p-8 rounded-[2.5rem] border border-white/10 text-center shadow-2xl">
                <div class="text-5xl mb-6">üéÅ</div>
                <h2 class="text-xl font-black mb-1">–í–∞—Å –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏!</h2>
                <p class="text-xs text-neutral-500 mb-6">–í–∞—à —Ä–µ—Ñ–µ—Ä–µ—Ä:</p>
                <div class="bg-white/5 p-4 rounded-2xl border border-white/5 mb-6">
                    <p id="ref-info-email" class="font-bold text-orange-500 truncate">...</p>
                </div>
                <div class="flex justify-between items-center bg-orange-500/10 p-4 rounded-2xl mb-8">
                    <p class="text-[10px] font-black uppercase text-orange-500">–í–∞—à –±–æ–Ω—É—Å</p>
                    <p class="text-lg font-black text-white">10.00 ƒê</p>
                </div>
                <button onclick="closeModal('ref-info')" class="w-full h-14 bg-white text-black rounded-2xl font-black uppercase text-xs">–ü—Ä–∏–Ω—è—Ç—å</button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª–∫–∞: –û–±–º–µ–Ω Beta -->
        <div id="modal-trade" class="hidden absolute inset-0 z-[150] bg-black/80 backdrop-blur-xl flex flex-col justify-end opacity-0 transition-all">
            <div id="modal-trade-content" class="bg-[#0f0f0f] border-t border-white/10 rounded-t-[2.5rem] p-8 transform translate-y-full transition-transform">
                <div class="w-12 h-1 bg-white/10 rounded-full mx-auto mb-6"></div>
                <h2 class="text-2xl font-black mb-6">–û–±–º–µ–Ω Œ≤</h2>
                
                <div class="flex bg-white/5 p-1 rounded-xl mb-6">
                    <button id="trade-buy-btn" onclick="setTradeMode('buy')" class="flex-1 py-3 rounded-lg text-[10px] font-black uppercase bg-white text-black transition-all">–ö—É–ø–∏—Ç—å</button>
                    <button id="trade-sell-btn" onclick="setTradeMode('sell')" class="flex-1 py-3 rounded-lg text-[10px] font-black uppercase text-neutral-500 transition-all">–ü—Ä–æ–¥–∞—Ç—å</button>
                </div>

                <div class="bg-white/5 p-5 rounded-2xl border border-white/10 mb-6">
                    <p id="trade-label" class="text-[9px] font-bold text-neutral-500 uppercase mb-1">–í—ã –æ—Ç–¥–∞–µ—Ç–µ (ƒê)</p>
                    <input type="number" id="trade-amount" placeholder="0.00" class="w-full bg-transparent text-3xl font-black outline-none">
                </div>
                
                <p class="text-center text-xs font-bold text-neutral-500 mb-6">–í—ã –ø–æ–ª—É—á–∏—Ç–µ ‚âà <span id="trade-result" class="text-white">0.00</span> <span id="trade-ticker">Œ≤</span></p>
                
                <button id="btn-do-trade" class="w-full h-16 bg-blue-600 rounded-2xl font-black text-xs uppercase tracking-widest">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button onclick="closeModal('trade')" class="w-full h-12 mt-2 text-neutral-600 font-bold text-xs uppercase">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª–∫–∞: –°—Ç–µ–π–∫–∏–Ω–≥ -->
        <div id="modal-staking" class="hidden absolute inset-0 z-[150] bg-black/80 backdrop-blur-xl flex items-center justify-center p-6 opacity-0 transition-all">
            <div class="w-full max-w-sm bg-[#111] border border-orange-500/20 rounded-[2.5rem] p-8 shadow-2xl relative">
                <button onclick="closeModal('staking')" class="absolute top-6 right-6 text-neutral-500">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
                <div class="text-center mb-8">
                    <div class="text-5xl mb-4">ü´ô</div>
                    <h2 class="text-2xl font-black">–°—Ç–µ–π–∫–∏–Ω–≥ –ë–∞–Ω–∫–∞</h2>
                    <p class="text-xs text-orange-500 font-bold mt-1 uppercase tracking-wider">–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ 5% / –Ω–µ–¥–µ–ª—é</p>
                </div>

                <div class="bg-black/50 p-5 rounded-2xl border border-white/5 mb-4">
                    <p class="text-[9px] text-neutral-500 uppercase font-bold mb-1">–ë–∞–ª–∞–Ω—Å —Å—Ç–µ–π–∫–∏–Ω–≥–∞</p>
                    <p class="text-2xl font-black"><span id="stake-modal-val">0.00</span> ƒê</p>
                    <div class="flex gap-2 mt-4">
                        <input type="number" id="stake-input" placeholder="–°—É–º–º–∞" class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 text-sm font-bold outline-none">
                        <button onclick="stakeAction('in')" class="px-4 py-2 bg-white text-black rounded-xl text-[10px] font-black uppercase">–í–≤–æ–¥</button>
                    </div>
                </div>
                
                <div class="flex items-center justify-between p-4 bg-green-500/5 border border-green-500/10 rounded-2xl">
                    <div>
                        <p class="text-[9px] text-neutral-500 uppercase font-bold">–ù–∞–∫–æ–ø–ª–µ–Ω–æ</p>
                        <p class="text-lg font-black text-green-500">+<span id="stake-profit">0.00</span> ƒê</p>
                    </div>
                    <button onclick="stakeAction('out')" class="bg-white/5 px-4 py-2 rounded-xl text-[10px] font-black uppercase border border-white/10">–°–Ω—è—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–æ–¥–∞–ª–∫–∏ (Send/Receive/Profile/Scan) -->
        <div id="modal-send" class="hidden absolute inset-0 z-[150] bg-black/80 backdrop-blur-xl flex flex-col justify-end opacity-0 transition-all">
            <div id="modal-send-content" class="bg-[#0f0f0f] border-t border-white/10 rounded-t-[2.5rem] p-8 transform translate-y-full transition-transform">
                <div class="w-12 h-1 bg-white/10 rounded-full mx-auto mb-8"></div>
                <h2 class="text-2xl font-black mb-6">–ü–µ—Ä–µ–≤–æ–¥ ƒê</h2>
                <div class="space-y-4">
                    <div class="bg-white/5 p-4 rounded-2xl border border-white/10">
                        <p class="text-[9px] font-bold text-neutral-500 uppercase mb-1">–ü–æ–ª—É—á–∞—Ç–µ–ª—å (Email)</p>
                        <input type="email" id="send-email" placeholder="example@mail.com" class="w-full bg-transparent outline-none font-bold">
                    </div>
                    <div class="bg-white/5 p-4 rounded-2xl border border-white/10">
                        <p class="text-[9px] font-bold text-neutral-500 uppercase mb-1">–°—É–º–º–∞</p>
                        <input type="number" id="send-amount" placeholder="0.00" class="w-full bg-transparent text-2xl font-black outline-none">
                    </div>
                    <button id="btn-do-send" class="w-full h-16 bg-white text-black rounded-2xl font-black uppercase text-xs tracking-widest mt-4">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    <button onclick="closeModal('send')" class="w-full h-12 text-neutral-600 font-bold uppercase text-xs">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>

        <div id="modal-receive" class="hidden absolute inset-0 z-[150] bg-black/80 backdrop-blur-xl flex flex-col justify-end opacity-0 transition-all">
            <div id="modal-receive-content" class="bg-[#0f0f0f] border-t border-white/10 rounded-t-[2.5rem] p-8 transform translate-y-full transition-transform text-center">
                <div class="w-12 h-1 bg-white/10 rounded-full mx-auto mb-8"></div>
                <h2 class="text-2xl font-black mb-1">–ü–æ–ª—É—á–∏—Ç—å ƒê</h2>
                <p class="text-neutral-500 text-xs mb-8">–í–∞—à QR-–∫–æ–¥ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞</p>
                <div class="inline-block p-4 bg-white rounded-3xl mb-8">
                    <div id="qrcode"></div>
                </div>
                <div onclick="copyMyEmail()" class="bg-white/5 p-4 rounded-2xl border border-white/10 flex justify-between items-center cursor-pointer">
                    <p id="my-email-display" class="font-mono text-xs text-orange-500 truncate">...</p>
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                </div>
                <button onclick="closeModal('receive')" class="w-full h-14 mt-6 text-neutral-600 font-bold uppercase text-xs">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <div id="modal-profile" class="hidden absolute inset-0 z-[150] bg-black/90 flex items-center justify-center p-8 opacity-0 transition-all">
            <div class="w-full max-w-xs bg-[#111] p-8 rounded-[2.5rem] border border-white/10 text-center">
                <div class="relative inline-block mb-6">
                    <img id="profile-avatar-big" class="w-24 h-24 rounded-full bg-neutral-800 border-4 border-black object-cover">
                    <label class="absolute bottom-0 right-0 w-8 h-8 bg-white text-black rounded-full flex items-center justify-center cursor-pointer">
                        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"/></svg>
                        <input type="file" id="avatar-input" class="hidden" accept="image/*">
                    </label>
                </div>
                <p id="profile-email-label" class="text-sm font-bold mb-8">...</p>
                <button onclick="closeModal('profile')" class="w-full h-14 bg-white/5 border border-white/10 rounded-2xl text-xs font-black uppercase">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <div id="modal-scan" class="hidden absolute inset-0 z-[200] bg-black flex flex-col">
            <div class="p-6 flex justify-between items-center z-10">
                <h2 class="text-xl font-black">–°–∫–∞–Ω–µ—Ä</h2>
                <button onclick="closeModal('scan')" class="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg>
                </button>
            </div>
            <div id="reader" class="flex-1"></div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, where, runTransaction, Timestamp, increment, getDocs } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBoFuGY-SSmcGHPGzuWZbdGFeI9_aaAKs8",
          authDomain: "doolcoinwallet.firebaseapp.com",
          projectId: "doolcoinwallet",
          storageBucket: "doolcoinwallet.firebasestorage.app",
          messagingSenderId: "473549726148",
          appId: "1:473549726148:web:87663b4944330c0df58491"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        let myData = null;
        let marketData = { budget: 10000000, supply: 10000000 };
        let tradeMode = 'buy';
        let html5QrCode = null;
        let chart = null;

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ ---
        function initChart() {
            const ctx = document.getElementById('betaChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(15).fill(''),
                    datasets: [{
                        data: Array(15).fill(1),
                        borderColor: '#00C6FF',
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 0,
                        fill: true,
                        backgroundColor: 'rgba(0, 198, 255, 0.05)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { display: false }, y: { display: false } }
                }
            });
        }
        initChart();

        // --- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –≤—Ö–æ–¥ ---
        const urlParams = new URLSearchParams(window.location.search);
        const refParam = urlParams.get('ref');
        if (refParam) {
            localStorage.setItem('dool_ref', refParam.toLowerCase());
            window.history.replaceState({}, '', window.location.pathname);
            document.getElementById('auth-ref-btn').classList.remove('hidden');
            document.getElementById('ref-info-email').textContent = refParam;
        }

        // --- Auth State ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userRef = doc(db, "users", user.uid);
                const snap = await getDoc(userRef);
                
                if (!snap.exists()) {
                    const email = user.email.toLowerCase();
                    const newUser = {
                        email: email,
                        balance: 10.0,
                        betaBalance: 0,
                        stakeBalance: 0,
                        lastStakeUpdate: Timestamp.now(),
                        avatar: user.photoURL || '',
                        refCount: 0,
                        refEarned: 0,
                        createdAt: Timestamp.now()
                    };
                    await setDoc(userRef, newUser);
                    
                    const savedRef = localStorage.getItem('dool_ref');
                    if (savedRef && savedRef !== email) {
                        const q = query(collection(db, "users"), where("email", "==", savedRef));
                        const rSnap = await getDocs(q);
                        if (!rSnap.empty) {
                            await updateDoc(rSnap.docs[0].ref, {
                                balance: increment(10),
                                refCount: increment(1),
                                refEarned: increment(10)
                            });
                        }
                    }
                    localStorage.removeItem('dool_ref');
                }
                startApp(user);
            } else {
                document.getElementById('view-loading').classList.add('hidden');
                document.getElementById('view-main').classList.add('hidden');
                document.getElementById('view-auth').classList.replace('hidden', 'flex');
            }
        });

        function startApp(user) {
            document.getElementById('main-username').textContent = user.email;
            document.getElementById('profile-email-label').textContent = user.email;
            document.getElementById('my-email-display').textContent = user.email;
            document.getElementById('ref-link').value = `${window.location.origin}${window.location.pathname}?ref=${user.email}`;

            // –°–ª—É—à–∞—Ç–µ–ª—å —é–∑–µ—Ä–∞
            onSnapshot(doc(db, "users", user.uid), (snap) => {
                myData = snap.data();
                if (!myData) return;

                // –ë–∞–ª–∞–Ω—Å —Å –∑–∞—â–∏—Ç–æ–π –º–∞—Å—à—Ç–∞–±–∞
                const bal = myData.balance || 0;
                const balEl = document.getElementById('balance-val');
                balEl.textContent = bal.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                if (bal > 999999) balEl.style.fontSize = "2.2rem";
                else if (bal > 9999) balEl.style.fontSize = "2.8rem";
                else balEl.style.fontSize = "";

                document.getElementById('user-beta').textContent = (myData.betaBalance || 0).toFixed(4);
                document.getElementById('staked-val').textContent = (myData.stakeBalance || 0).toFixed(2);
                document.getElementById('stake-modal-val').textContent = (myData.stakeBalance || 0).toFixed(2);
                document.getElementById('ref-count').textContent = myData.refCount || 0;
                document.getElementById('ref-earned').textContent = (myData.refEarned || 0).toFixed(2);

                const av = myData.avatar || `https://ui-avatars.com/api/?background=random&color=fff&name=${user.email[0]}`;
                document.getElementById('main-avatar').src = av;
                document.getElementById('profile-avatar-big').src = av;

                document.getElementById('view-loading').classList.add('hidden');
                document.getElementById('view-auth').classList.add('hidden');
                document.getElementById('view-main').classList.replace('hidden', 'flex');
            });

            // –°–ª—É—à–∞—Ç–µ–ª—å —Ä—ã–Ω–∫–∞
            onSnapshot(doc(db, "system", "market"), (snap) => {
                if (snap.exists()) marketData = snap.data();
                else setDoc(doc(db, "system", "market"), marketData);

                // –ó–∞—â–∏—Ç–∞ –æ—Ç NaN: –±—é–¥–∂–µ—Ç / —Å–∞–ø–ª–∞–π
                const price = (marketData.budget || 10000000) / (marketData.supply || 10000000);
                document.getElementById('beta-price').textContent = price.toFixed(2) + ' ƒê';
                document.getElementById('beta-cap').textContent = marketData.budget.toLocaleString() + ' ƒê';

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
                const chartData = chart.data.datasets[0].data;
                chartData.shift();
                chartData.push(price);
                chart.update();
                updateTradeCalc();
            });

            // –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            const q = query(collection(db, "transactions"), where("parties", "array-contains", user.email.toLowerCase()));
            onSnapshot(q, (snap) => {
                const list = document.getElementById('tx-history');
                if (snap.empty) {
                    list.innerHTML = `<p class="text-center text-neutral-800 text-[10px] font-bold uppercase py-10">–¢—É—Ç –ø–æ–∫–∞ –ø—É—Å—Ç–æ</p>`;
                    return;
                }
                const sorted = snap.docs.map(d => d.data()).sort((a,b) => b.date - a.date);
                list.innerHTML = sorted.map(tx => {
                    const isOut = tx.from === user.email.toLowerCase();
                    const partner = isOut ? tx.to : tx.from;
                    const sign = isOut ? '-' : '+';
                    const color = isOut ? 'text-white' : 'text-orange-500';
                    const avatar = `https://ui-avatars.com/api/?background=${isOut ? '333' : 'FF4D0010'}&color=${isOut ? 'fff' : 'FF4D00'}&name=${partner[0]}`;
                    
                    return `
                        <div class="flex items-center justify-between p-4 rounded-3xl bg-white/[0.03] border border-white/5">
                            <div class="flex items-center gap-3">
                                <img src="${avatar}" class="w-8 h-8 rounded-full border border-white/5">
                                <div class="min-w-0">
                                    <p class="text-[9px] font-black uppercase text-neutral-500 tracking-tighter">${isOut ? '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ' : '–ü–æ–ª—É—á–µ–Ω–æ'}</p>
                                    <p class="text-xs font-bold truncate w-28">${partner}</p>
                                </div>
                            </div>
                            <p class="text-sm font-black ${color}">${sign}${tx.amount.toFixed(2)}</p>
                        </div>
                    `;
                }).join('');
            });
        }

        // --- –¢–æ—Ä–≥–æ–≤–ª—è Œ≤ ---
        window.setTradeMode = (m) => {
            tradeMode = m;
            document.getElementById('trade-buy-btn').className = m === 'buy' ? "flex-1 py-3 rounded-lg text-[10px] font-black uppercase bg-white text-black" : "flex-1 py-3 rounded-lg text-[10px] font-black uppercase text-neutral-500";
            document.getElementById('trade-sell-btn').className = m === 'sell' ? "flex-1 py-3 rounded-lg text-[10px] font-black uppercase bg-white text-black" : "flex-1 py-3 rounded-lg text-[10px] font-black uppercase text-neutral-500";
            document.getElementById('trade-label').textContent = m === 'buy' ? '–í—ã –æ—Ç–¥–∞–µ—Ç–µ (ƒê)' : '–í—ã –æ—Ç–¥–∞–µ—Ç–µ (Œ≤)';
            document.getElementById('trade-ticker').textContent = m === 'buy' ? 'Œ≤' : 'ƒê';
            updateTradeCalc();
        };

        function updateTradeCalc() {
            const price = marketData.budget / marketData.supply;
            const val = parseFloat(document.getElementById('trade-amount').value) || 0;
            const res = document.getElementById('trade-result');
            res.textContent = tradeMode === 'buy' ? (val / price).toFixed(4) : (val * price).toFixed(2);
        }
        document.getElementById('trade-amount').oninput = updateTradeCalc;

        document.getElementById('btn-do-trade').onclick = async () => {
            const amt = parseFloat(document.getElementById('trade-amount').value);
            if (!amt || amt <= 0) return showT('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É', true);
            
            const btn = document.getElementById('btn-do-trade');
            btn.disabled = true;

            try {
                await runTransaction(db, async (t) => {
                    const uRef = doc(db, "users", auth.currentUser.uid);
                    const mRef = doc(db, "system", "market");
                    const ud = (await t.get(uRef)).data();
                    const md = (await t.get(mRef)).data();
                    const price = md.budget / md.supply;

                    if (tradeMode === 'buy') {
                        if (ud.balance < amt) throw new Error("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ƒê");
                        t.update(uRef, { balance: increment(-amt), betaBalance: increment(amt / price) });
                        t.update(mRef, { budget: increment(amt) });
                    } else {
                        if (ud.betaBalance < amt) throw new Error("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Œ≤");
                        const payout = amt * price;
                        t.update(uRef, { betaBalance: increment(-amt), balance: increment(payout) });
                        t.update(mRef, { budget: increment(-payout) });
                    }
                });
                closeModal('trade');
                showT('–£—Å–ø–µ—à–Ω–æ', '–°–¥–µ–ª–∫–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–∞');
            } catch (e) { showT('–û—à–∏–±–∫–∞', e.message, true); }
            finally { btn.disabled = false; }
        };

        // --- –°—Ç–µ–π–∫–∏–Ω–≥ ---
        window.stakeAction = async (type) => {
            const uRef = doc(db, "users", auth.currentUser.uid);
            try {
                if (type === 'in') {
                    const val = parseFloat(document.getElementById('stake-input').value);
                    if (!val || val <= 0 || val > myData.balance) return showT('–û—à–∏–±–∫–∞', '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—É–º–º–∞', true);
                    await updateDoc(uRef, { balance: increment(-val), stakeBalance: increment(val), lastStakeUpdate: Timestamp.now() });
                    document.getElementById('stake-input').value = '';
                    showT('–°—Ç–µ–π–∫–∏–Ω–≥', '–î–µ–ø–æ–∑–∏—Ç –ø—Ä–∏–Ω—è—Ç');
                } else {
                    const bal = myData.stakeBalance || 0;
                    if (bal <= 0) return;
                    const now = Date.now();
                    const last = myData.lastStakeUpdate.toMillis();
                    const weeks = (now - last) / (1000 * 60 * 60 * 24 * 7);
                    const profit = bal * 0.05 * weeks; // 5% –ª–∏–Ω–µ–π–Ω–æ
                    await updateDoc(uRef, { balance: increment(bal + profit), stakeBalance: 0, lastStakeUpdate: Timestamp.now() });
                    showT('–°—Ç–µ–π–∫–∏–Ω–≥', '–°—Ä–µ–¥—Å—Ç–≤–∞ –≤—ã–≤–µ–¥–µ–Ω—ã');
                }
            } catch(e) { showT('–û—à–∏–±–∫–∞', '–°–±–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏', true); }
        };

        setInterval(() => {
            if (myData && myData.stakeBalance > 0) {
                const now = Date.now();
                const last = myData.lastStakeUpdate.toMillis();
                const weeks = (now - last) / (1000 * 60 * 60 * 24 * 7);
                document.getElementById('stake-profit').textContent = (myData.stakeBalance * 0.05 * weeks).toFixed(4);
            }
        }, 1000);

        // --- –ü–µ—Ä–µ–≤–æ–¥—ã ---
        document.getElementById('btn-do-send').onclick = async () => {
            const to = document.getElementById('send-email').value.trim().toLowerCase();
            const amt = parseFloat(document.getElementById('send-amount').value);
            if (to === auth.currentUser.email.toLowerCase()) return showT('–û—à–∏–±–∫–∞', '–°–µ–±–µ –Ω–µ–ª—å–∑—è', true);
            if (!amt || amt < 0.01) return showT('–û—à–∏–±–∫–∞', '–ú–∏–Ω–∏–º—É–º 0.01', true);
            
            try {
                const q = query(collection(db, "users"), where("email", "==", to));
                const res = await getDocs(q);
                if (res.empty) throw new Error("–Æ–∑–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω");

                await runTransaction(db, async (t) => {
                    const sRef = doc(db, "users", auth.currentUser.uid);
                    const rRef = res.docs[0].ref;
                    const sd = (await t.get(sRef)).data();
                    if (sd.balance < amt) throw new Error("–ú–∞–ª–æ —Å—Ä–µ–¥—Å—Ç–≤");
                    
                    t.update(sRef, { balance: increment(-amt) });
                    t.update(rRef, { balance: increment(amt) });
                    t.set(doc(collection(db, "transactions")), {
                        from: auth.currentUser.email.toLowerCase(),
                        to: to,
                        amount: amt,
                        date: Timestamp.now(),
                        parties: [auth.currentUser.email.toLowerCase(), to]
                    });
                });
                closeModal('send');
                showT('–£—Å–ø–µ—à–Ω–æ', `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${to}`);
            } catch(e) { showT('–û—à–∏–±–∫–∞', e.message, true); }
        };

        // --- UI Utils ---
        window.switchTab = (t) => {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            ['wallet','invest','referrals'].forEach(n => {
                const el = document.getElementById('nav-'+n);
                el.className = n === t ? "flex-1 flex flex-col items-center justify-center h-full text-orange-500" : "flex-1 flex flex-col items-center justify-center h-full text-neutral-600";
            });
        };

        window.openModal = (n) => {
            const m = document.getElementById('modal-'+n);
            m.classList.remove('hidden');
            setTimeout(() => {
                m.classList.replace('opacity-0', 'opacity-100');
                const c = document.getElementById(`modal-${n}-content`);
                if (c) c.classList.remove('translate-y-full');
            }, 10);
            if(n === 'receive') {
                document.getElementById('qrcode').innerHTML = '';
                new QRCode(document.getElementById("qrcode"), { text: JSON.stringify({e:auth.currentUser.email}), width: 180, height: 180, colorDark:"#000", colorLight:"#fff" });
            }
            if(n === 'scan') startScanner();
        };

        window.closeModal = (n) => {
            const m = document.getElementById('modal-'+n);
            const c = document.getElementById(`modal-${n}-content`);
            if (c) c.classList.add('translate-y-full');
            m.classList.replace('opacity-100', 'opacity-0');
            setTimeout(() => m.classList.add('hidden'), 300);
            if(n === 'scan') stopScanner();
        };

        window.showT = (title, msg, err = false) => {
            const t = document.getElementById('toast');
            document.getElementById('toast-title').textContent = title;
            document.getElementById('toast-msg').textContent = msg;
            document.getElementById('toast-icon').innerHTML = err ? '‚úï' : '‚úì';
            document.getElementById('toast-icon').className = `w-10 h-10 rounded-full flex items-center justify-center font-bold ${err ? 'bg-red-500/10 text-red-500' : 'bg-green-500/10 text-green-500'}`;
            t.classList.add('active');
            setTimeout(() => t.classList.remove('active'), 3000);
        };

        function startScanner() {
            html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (text) => {
                try {
                    const d = JSON.parse(text);
                    if(d.e) {
                        closeModal('scan');
                        openModal('send');
                        document.getElementById('send-email').value = d.e;
                    }
                } catch(e) {}
            });
        }
        function stopScanner() { if(html5QrCode) html5QrCode.stop().then(() => html5QrCode.clear()); }

        window.copyRef = () => { navigator.clipboard.writeText(document.getElementById('ref-link').value); showT('–£—Å–ø–µ—à–Ω–æ', '–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞'); };
        window.copyMyEmail = () => { navigator.clipboard.writeText(auth.currentUser.email); showT('–£—Å–ø–µ—à–Ω–æ', 'Email —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω'); };
        
        document.getElementById('avatar-input').onchange = (e) => {
            const f = e.target.files[0];
            if(!f) return;
            const reader = new FileReader();
            reader.onload = async (ev) => {
                await updateDoc(doc(db, "users", auth.currentUser.uid), { avatar: ev.target.result });
            };
            reader.readAsDataURL(f);
        };

        document.getElementById('btn-login').onclick = () => signInWithEmailAndPassword(auth, document.getElementById('auth-email').value, document.getElementById('auth-password').value).catch(e => showT('–û—à–∏–±–∫–∞', '–í—Ö–æ–¥ –Ω–µ —É–¥–∞–ª—Å—è', true));
        document.getElementById('btn-register').onclick = () => createUserWithEmailAndPassword(auth, document.getElementById('auth-email').value, document.getElementById('auth-password').value).catch(e => showT('–û—à–∏–±–∫–∞', '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è', true));
        document.getElementById('btn-logout').onclick = () => signOut(auth);

    </script>
</body>
</html>